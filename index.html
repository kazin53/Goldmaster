<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lobby Clássico 3D - Estilo Madeira e Pedra</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=IM+Fell+Great+Primer+SC&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #000; 
            font-family: 'IM Fell Great Primer SC', serif; 
            color: #eee; 
        }
        canvas { 
            display: block; 
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* --- UI Geral --- */
        
        .ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; 
        }

        .ui-top-left {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: auto; 
        }

        .ui-bottom-right {
            position: absolute;
            bottom: 30px;
            right: 30px;
            pointer-events: auto; 
            display: flex;
            align-items: flex-end; 
            gap: 10px; 
            /* Adicionado alinhamento para o indicador de mundo */
            flex-direction: column; 
        }
        
        /* NOVO: Estilo para mostrar o mundo ativo */
        #active-world-display {
            font-family: 'IM Fell Great Primer SC', serif;
            color: #FFD700;
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.6); 
            padding: 8px 15px;
            border: 2px solid #5a3c26; /* Borda de madeira escura */
            
            font-size: 16px;
            text-align: right;
            margin-bottom: 5px; 
            min-width: 200px;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        /* --- Botões Base (Madeira) --- */
        .lobby-button {
            background-image: url(); 
            background-size: cover;
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.6); 
            background-blend-mode: soft-light; 
            color: #e1eb34; 
            border: 3px solid transparent; 
            padding: 5px 20px;
            font-size: 15px; 
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s ease;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7); 
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9); 
            min-width: 100px;
            text-align: left;
            border-radius: 20px; 
        }

        .lobby-button:hover {
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.5); 
            background-blend-mode: overlay; 
            color: #ffffff;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 0 0 15px rgba(255, 215, 0, 0.5); 
        }
        
        /* --- Botão "mundos" (Estilo Pedra) --- */
        #worlds-button {
            background-size: cover;
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.7); 
            background-blend-mode: soft-light;
            color: #ccc; 
            font-size: 15px;
            height: 47px;
            width: 30;
            min-width: auto; 
            text-align: center;
            border-radius: 20px;
        }

        #worlds-button:hover {
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.5); 
            background-blend-mode: overlay;
            color: #fff;
        }

        /* --- Botão "GO! World" (Madeira com Destaque Dourado) --- */
        #go-button {
            background-size: cover;
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.9); 
            background-blend-mode: soft-light;
            padding: 20px 40px;
            font-size: 15px; 
            font-family: 'Cinzel Decorative', cursive; 
            color: #FFD700; 
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.9), 0 0 10px rgba(255, 215, 0, 0.5); 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), inset 0 0 15px rgba(255, 215, 0, 0.3); 
            pointer-events: none; /* COMEÇA INATIVO */
            opacity: 0.6;
            cursor: not-allowed;
        }

        #go-button.active {
            pointer-events: auto; /* ATIVADO APÓS SELEÇÃO */
            opacity: 1;
            cursor: pointer;
        }
        
        #go-button:hover {
            /* Mantido o hover, mas só será ativado se tiver a classe .active */
            background-blend-mode: luminosity; 
            color: #FFFFFF;
            transform: scale(1.03); 
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.9), inset 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        /* --- Modal de Seleção de Mundos (Painel de Pedra) --- */
        #worlds-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            z-index: 20; 
            display: none; 
            justify-content: center;
            align-items: center;
            pointer-events: auto; 
        }

        .worlds-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 25px; 
            max-width: 950px; 
            padding: 30px;
            
            background-size: cover;
            /* Alterado para sutilmente escuro e transparente */
            background-color: rgba(0, 0, 0, 0.8); 
            background-blend-mode: multiply;

            border: 5px solid transparent;
            border-radius: 0; 
            box-shadow: 0 0 40px rgba(100, 100, 100, 0.8); 
        }

        /* --- Cards de Mundos --- */
        .world-card {
            width: 250px;
            height: 200px;
            border: 3px solid transparent; 
            cursor: pointer;
            transition: transform 0.2s, border-image 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-start;
            padding: 10px;
            box-sizing: border-box;
            background-size: cover; 
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.7); 
            
            position: relative; 
        }
        
        /* Adiciona um destaque visual no card selecionado no modal */
        .world-card.selected {
            border-image: url('https://i.imgur.com/d9j8C1Y.png') 10 / 10px stretch; /* Borda de cristal/diamante */
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8); /* Brilho azul/água para indicar seleção */
            transform: scale(1.02);
        }
        

        /* REFERÊNCIAS PARA OS ARQUIVOS LOCAIS DE FOTO */
        #world-1 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo01.png'); } 
        #world-2 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo02.png'); }
        #world-3 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo03.png'); }
        #world-4 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo04.png'); }
        #world-5 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo05.png'); }
        #world-6 { background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('mundo06.png'); }


        .world-card:hover {
            transform: scale(1.04);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 10px rgba(255, 215, 0, 0.5); 
        }

        .world-name {
            /* Fundo ligeiramente mais transparente */
            background-color: rgba(0, 0, 0, 0.7);
            color: #f0e68c; 
            padding: 8px 12px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 3px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            position: absolute; 
            bottom: 10px;
            left: 10px;
            font-family: 'Cinzel Decorative', cursive;
        }
        

        
    </style>
</head>
<body>
    
    <div class="ui-container">
        <div class="ui-top-left">
            <button class="lobby-button">Perfil</button>
            <button class="lobby-button">Amigos</button>
            <button class="lobby-button">Loja</button>
            <button class="lobby-button">Opções</button>
        </div>

        <div class="ui-bottom-right">
            <div id="active-world-display">Nenhum mundo selecionado</div>
            
            <div class="button-group">
                <button class="lobby-button" id="worlds-button">MUNDOS</button>
                <button class="lobby-button" id="go-button">GO! WORLD</button> 
            </div>
        </div>
    </div>
    
    <div id="worlds-menu">
        <div class="worlds-grid">
            <div class="world-card" id="world-1" data-world-id="1">
                <span class="world-name">Floresta Mística</span>
            </div>
            <div class="world-card" id="world-2" data-world-id="2">
                <span class="world-name">Cidade Cyber</span>
            </div>
            <div class="world-card" id="world-3" data-world-id="3">
                <span class="world-name">Deserto Antigo</span>
            </div>
            <div class="world-card" id="world-4" data-world-id="4">
                <span class="world-name">Reino de Gelo</span>
            </div>
            <div class="world-card" id="world-5" data-world-id="5">
                <span class="world-name">Ilha Vulcânica</span>
            </div>
            <div class="world-card" id="world-6" data-world-id="6">
                <span class="world-name">O Espaço</span>
            </div>
        </div>
        <button class="close-button" id="close-worlds-menu">X</button>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls, snowParticles;
        const ornaments = [];
        const gifts = [];
        const clock = new THREE.Clock(); 
        
        // NOVO: Variável global para rastrear o mundo selecionado
        let selectedWorldId = null; 
        let selectedWorldName = "Nenhum mundo selecionado";


        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111133); 
            scene.fog = new THREE.Fog(0x111133, 15, 40);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 12);

            renderer = new THREE.WebGLRenderer({ antialias: true }); 
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2 - 0.05;
            controls.minDistance = 5;
            controls.maxDistance = 30;

            createWorld();
            createSnow();
            createInteractions();
            createUIListeners(); 
            
            // Define o primeiro mundo como selecionado por padrão
            setActiveWorld(1, 'Floresta Mística'); 
        }

        function createWorld() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
            directionalLight.position.set(10, 15, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -25;
            directionalLight.shadow.camera.right = 25;
            directionalLight.shadow.camera.top = 25;
            directionalLight.shadow.camera.bottom = -25;
            scene.add(directionalLight);

            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff, 
                roughness: 0.9,
                metalness: 0.1
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true; 
            scene.add(floor);

            const trunkGeometry = new THREE.CylinderGeometry(0.3, 0.3, 1, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 0.5;
            trunk.castShadow = true;
            scene.add(trunk);
            
            const treeGeometry = new THREE.ConeGeometry(2.5, 6, 12);
            const treeMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x228B22,
                roughness: 0.8
            });
            const tree = new THREE.Mesh(treeGeometry, treeMaterial);
            tree.position.set(0, 4, 0); 
            tree.castShadow = true; 
            scene.add(tree);

            const starGeometry = new THREE.OctahedronGeometry(0.5);
            const starMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xFFD700,
                emissive: 0xFFFF00, 
                emissiveIntensity: 1.5 
            });
            const star = new THREE.Mesh(starGeometry, starMaterial);
            star.position.set(0, 7.2, 0); 
            scene.add(star);
            
            const starLight = new THREE.PointLight(0xFFFF88, 1.5, 10);
            starLight.position.set(0, 7, 0);
            scene.add(starLight);

            const giftMat1 = new THREE.MeshStandardMaterial({ color: 0xFF0000, roughness: 0.6 });
            const giftMat2 = new THREE.MeshStandardMaterial({ color: 0x0000FF, roughness: 0.6 });
            
            const gift1 = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), giftMat1);
            gift1.position.set(-3, 0.5, 3);
            gift1.castShadow = true;
            gift1.name = "Presente Vermelho"; 
            scene.add(gift1);
            gifts.push(gift1);

            const gift2 = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), giftMat2);
            gift2.position.set(3.5, 0.6, 2);
            gift2.castShadow = true;
            gift2.name = "Presente Azul";
            scene.add(gift2);
            gifts.push(gift2);

            const ornamentGeo = new THREE.SphereGeometry(0.15, 16, 16);
            for (let i = 0; i < 30; i++) {
                const color = new THREE.Color(Math.random() * 0xffffff);
                const ornamentMat = new THREE.MeshStandardMaterial({
                    color: color,
                    emissive: color,
                    emissiveIntensity: 0
                });
                const ornament = new THREE.Mesh(ornamentGeo, ornamentMat);
                const r = Math.random() * 2.0 + 0.3; 
                const y = Math.random() * 5.0 + 1.0; 
                const angle = Math.random() * Math.PI * 2;
                const coneRadiusAtY = (6 - (y - 1)) / 6 * 2.5;
                ornament.position.set(
                    Math.cos(angle) * coneRadiusAtY * (Math.random() * 0.9 + 0.1),
                    y,
                    Math.sin(angle) * coneRadiusAtY * (Math.random() * 0.9 + 0.1)
                );
                scene.add(ornament);
                ornaments.push(ornament);
            }
        }

        function createSnow() {
            const vertices = [];
            for (let i = 0; i < 5000; i++) {
                const x = Math.random() * 60 - 30;
                const y = Math.random() * 40 - 10;
                const z = Math.random() * 60 - 30;
                vertices.push(x, y, z);
            }

            const snowGeometry = new THREE.BufferGeometry();
            snowGeometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

            const snowMaterial = new THREE.PointsMaterial({
                color: 0xFFFFFF,
                size: 0.1, 
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending, 
                depthWrite: false 
            });

            snowParticles = new THREE.Points(snowGeometry, snowMaterial);
            scene.add(snowParticles);
        }

        function createInteractions() {
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();

            window.addEventListener('click', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);

                const intersects = raycaster.intersectObjects(gifts);
                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (!obj.isAnimating) {
                        obj.isAnimating = true;
                        console.log(`Você clicou no ${obj.name}!`);
                    }
                }
                
                const worldsMenu = document.getElementById('worlds-menu');
                // Clicar fora do modal (no overlay) para fechar
                if (worldsMenu.style.display === 'flex' && event.target === worldsMenu) {
                    worldsMenu.style.display = 'none';
                }
            });
        }
        
        // NOVO: Função para atualizar a variável global e o display
        function setActiveWorld(id, name) {
            selectedWorldId = id;
            selectedWorldName = name;
            
            // 1. Atualiza o display no lobby
            document.getElementById('active-world-display').innerText = `Mundo Selecionado: ${name}`;
            
            // 2. Ativa o botão GO!
            const goButton = document.getElementById('go-button');
            goButton.classList.add('active');
            
            // 3. Atualiza o destaque no modal
            document.querySelectorAll('.world-card').forEach(card => {
                card.classList.remove('selected');
                if (card.getAttribute('data-world-id') == id) {
                    card.classList.add('selected');
                }
            });
            
            console.log(`Mundo ativo definido: ID ${id} - ${name}`);
        }

        function createUIListeners() {
            const worldsMenu = document.getElementById('worlds-menu');
            const goButton = document.getElementById('go-button');
            
            // Ouvinte para o botão "MUNDOS" (para abrir o modal)
            document.getElementById('worlds-button').addEventListener('click', (e) => {
                e.stopPropagation(); 
                worldsMenu.style.display = 'flex'; 
                console.log('Abrindo seletor de MUNDOS!');
            });
            
            // NOVO: Ouvinte para o botão "GO! WORLD" - Inicia o jogo com o mundo SELECIONADO
            goButton.addEventListener('click', (e) => {
                e.stopPropagation(); 
                
                if (selectedWorldId) {
                    const targetFile = `car${selectedWorldId}.html`;
                    console.log(`Iniciando o Jogo no mundo ${selectedWorldName}. Redirecionando para ${targetFile}...`);
                    window.location.href = targetFile; // REDIRECIONA
                } else {
                    alert('Por favor, selecione um mundo antes de iniciar!');
                }
            });
            
            // Ouvinte para o botão de fechar "X"
            document.getElementById('close-worlds-menu').addEventListener('click', (e) => {
                e.stopPropagation();
                worldsMenu.style.display = 'none'; 
            });
            
            // NOVO: Ouvintes para os Cards de Mundo - APENAS SELECIONAM O MUNDO E VOLTAM AO LOBBY
            document.querySelectorAll('.world-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    const worldId = e.currentTarget.getAttribute('data-world-id');
                    const worldName = e.currentTarget.querySelector('.world-name').innerText;
                    
                    // 1. Armazena o mundo ativo e atualiza o display
                    setActiveWorld(worldId, worldName);
                    
                    // 2. Fecha o modal
                    worldsMenu.style.display = 'none'; 
                });
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta(); 
            const time = clock.getElapsedTime(); 

            controls.update();

            ornaments.forEach((orn, i) => {
                const intensity = (Math.sin(time * 3.0 + i) + 1) / 2 * 1.5 + 0.5;
                orn.material.emissiveIntensity = intensity;
            });

            const positions = snowParticles.geometry.attributes.position.array;
            for (let i = 0; i < positions.length; i += 3) {
                positions[i + 1] -= (0.1 + Math.random() * 0.05) * delta * 10; 
                positions[i] += (Math.random() - 0.5) * 0.01; 
                if (positions[i + 1] < -5) {
                    positions[i + 1] = Math.random() * 20 + 20;
                    positions[i] = Math.random() * 60 - 30;
                }
            }
            snowParticles.geometry.attributes.position.needsUpdate = true;
            
            gifts.forEach(gift => {
                if (gift.isAnimating) {
                    gift.scale.lerp(new THREE.Vector3(1.2, 1.2, 1.2), delta * 8);
                    if (gift.scale.x > 1.19) {
                        gift.isAnimating = false;
                        gift.isPopped = true;
                    }
                } else if (gift.isPopped) {
                    gift.scale.lerp(new THREE.Vector3(1, 1, 1), delta * 8);
                    if (gift.scale.x < 1.01) {
                        gift.isPopped = false;
                    }
                }
            });

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
